<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å®¢æˆ¶ç¶­è­·ç®¡ç†ç³»çµ±</title>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

  <style>
    :root {
      --primary: #4361ee; --primary-light: #eef2ff; --success: #10b981;
      --success-light: #e8f7f0; --success-dark: #065f46;
      --warning: #f59e0b; --danger: #ef4444; 
      --text-main: #1e293b; 
      --text-muted: #64748b; 
      --text-soft: #334155; /* æ·±ç°è‰²ï¼Œç”¨æ–¼é™ä½çœ¼ç›ç–²å‹ */
      --bg-body: #f8fafc; --card-bg: #ffffff;
      --border: #e2e8f0; --radius-lg: 16px; --radius-md: 12px;
      --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
    * { box-sizing: border-box; }
    body { display: none; margin: 0; font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: var(--bg-body); color: var(--text-main); }
    
    header { background: var(--card-bg); border-bottom: 1px solid var(--border); padding: 0.75rem 1.5rem; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
    .logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.25rem; color: var(--primary); }
    
    main { max-width: 1550px; margin: 1.5rem auto; padding: 0 1rem; }
    
    .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
    .stat-card { background: var(--card-bg); padding: 1.5rem; border-radius: var(--radius-lg); box-shadow: var(--shadow); display: flex; align-items: center; gap: 1.25rem; border: 1px solid var(--border); }
    .stat-icon { width: 64px; height: 64px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; }
    .stat-icon .material-symbols-rounded { font-size: 32px; }
    .stat-info .stat-label { font-size: 0.95rem; color: var(--text-muted); margin-bottom: 2px; font-weight: 500; }
    
    /* èª¿æ•´æ•¸å­—é¡è‰²ç‚ºæ·±ç°è‰²ï¼Œæ¸›è¼•ç–²å‹ */
    .stat-info .stat-value { font-size: 2.2rem; font-weight: 900; line-height: 1.1; color: var(--text-soft); letter-spacing: -1px; }

    .controls { display: flex; gap: 0.75rem; margin-bottom: 1rem; align-items: center; }
    .search-wrapper { flex: 1; position: relative; }
    
    .btn { padding: 8px 16px; border-radius: var(--radius-md); border: none; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; font-size: 0.9rem; transition: 0.2s; }
    .btn-outline { background: white; border: 1px solid var(--border); color: var(--text-main); }
    .btn-primary { background: var(--primary); color: white; }

    .table-container { background: var(--card-bg); border-radius: var(--radius-lg); box-shadow: var(--shadow); overflow: hidden; border: 1px solid var(--border); }
    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th { background: #f8fafc; padding: 12px 16px; font-size: 0.85rem; color: var(--text-muted); text-align: left; border-bottom: 1px solid var(--border); }
    td { padding: 12px 16px; border-bottom: 1px solid var(--border); vertical-align: middle; }
    
    /* èª¿æ•´æ¬„ä½å¯¬åº¦ä½”æ¯”ï¼Œé¿å…æŒ‰éˆ•è¢«æˆªæ‰ */
    .col-customer { width: 18%; }
    .col-product  { width: 12%; }
    .col-period   { width: 15%; }
    .col-schedule { width: 32%; } /* ç¸®æ¸›ä¸€äº› */
    .col-status   { width: 15%; } /* ç‹€æ…‹æ¬„å·¦ç§»(åŠ å¯¬ä¸¦é å·¦å°é½Š) */
    .col-action   { width: 8%; }  /* åŠ å¯¬ä»¥ç¢ºä¿æŒ‰éˆ•å®Œæ•´é¡¯ç¤º */

    .sales-tag { background: #e0e7ff; color: #4338ca; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; display: inline-block; margin-top: 4px; }
    
    .month-group { display: flex; flex-wrap: wrap; gap: 3px; }
    .month-chip { padding: 2px 4px; border-radius: 3px; font-size: 11px; background: #f1f5f9; color: var(--text-muted); border: 1px solid var(--border); min-width: 32px; text-align: center; }
    .month-chip.is-done { background: var(--success-light); color: var(--success-dark); border-color: #a7f3d0; }
    .month-chip.active { border: 1.5px solid var(--primary); font-weight: 700; color: var(--primary); background: #fff; }

    .done-status-box { 
        background: var(--success-light); 
        color: var(--success-dark); 
        padding: 6px 12px; 
        border-radius: 8px; 
        display: inline-flex;
        flex-direction: column;
        border: 1px solid #c6f6d5;
        min-width: 125px;
        margin-right: 10px; /* å¢åŠ å³å´ç•™ç™½ */
    }
    .done-status-box .status-title { 
        font-size: 1.05rem; 
        font-weight: 900; 
        letter-spacing: 2px;
        margin-bottom: 1px;
    }
    .done-status-box .status-meta { 
        font-size: 11px; 
        opacity: 0.9; 
        font-weight: 500;
        white-space: nowrap; 
    }

    .note-indicator { color: #94a3b8; cursor: pointer; margin-left: 6px; vertical-align: middle; font-size: 18px; }

    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); z-index: 999; display: none; }
    .drawer { position: fixed; right: -100%; top: 0; width: 100%; max-width: 550px; height: 100%; background: white; z-index: 1000; transition: right 0.3s ease; padding: 2rem; overflow-y: auto; }
    .drawer.open { right: 0; }
    .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); background: white; padding: 1.5rem; border-radius: var(--radius-lg); z-index: 1100; width: 90%; max-width: 400px; display: none; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
    
    .ym-manager { margin-top: 10px; border: 1px solid var(--border); border-radius: 8px; padding: 10px; background: #f8fafc; }
    .ym-list { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px; }
    .ym-tag { background: white; border: 1px solid var(--border); padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; }
  </style>
</head>
<body>

  <header>
    <div class="logo"><span class="material-symbols-rounded">analytics</span> å®¢æˆ¶ç¶­è­·ç®¡ç†ç³»çµ±</div>
    <div style="display:flex; gap:10px;">
      <div id="modeSeg" style="display:flex; background:var(--primary-light); padding:4px; border-radius:100px;">
        <button class="mode-btn btn active" data-mode="user">æª¢è¦–æ¨¡å¼</button>
        <button class="mode-btn btn" data-mode="admin">ç®¡ç†æ¨¡å¼</button>
      </div>
      <button id="btnNew" class="btn btn-primary" style="display:none;"><span class="material-symbols-rounded">add</span>æ–°å¢ç¶­è­·</button>
    </div>
  </header>

  <main>
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon" style="background:#eef2ff; color:var(--primary);"><span class="material-symbols-rounded">groups</span></div>
        <div class="stat-info"><div class="stat-label">ç¸½å®¢æˆ¶æ•¸</div><div class="stat-value" id="statTotal">0</div></div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:var(--success-light); color:var(--success);"><span class="material-symbols-rounded">check_circle</span></div>
        <div class="stat-info"><div class="stat-label" id="statDoneLabel">æœ¬æœˆå·²å®Œå·¥</div><div class="stat-value" id="statDone">0</div></div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:#fff7ed; color:var(--warning);"><span class="material-symbols-rounded">pending_actions</span></div>
        <div class="stat-info"><div class="stat-label" id="statTodoLabel">æœ¬æœˆå¾…è™•ç†</div><div class="stat-value" id="statTodo">0</div></div>
      </div>
    </div>

    <div class="controls">
      <div class="search-wrapper">
        <span class="material-symbols-rounded" style="position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text-muted);">search</span>
        <input type="text" id="q" placeholder="æœå°‹å®¢æˆ¶åç¨±ã€æ¥­å‹™ã€ç”¢å“..." style="width:100%; padding:10px 16px 10px 40px; border-radius:var(--radius-md); border:1px solid var(--border); outline:none;">
      </div>
      <input type="month" id="monthPick" class="btn btn-outline">
      <select id="scope" class="btn btn-outline">
        <option value="all">é¡¯ç¤ºå…¨éƒ¨</option>
        <option value="need" selected>æœ¬æœˆç¶­è­·</option>
      </select>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th class="col-customer">å®¢æˆ¶åç¨±</th>
            <th class="col-product">ç”¢å“ / æ¥­å‹™</th>
            <th class="col-period">ç¶­è­·æœŸé–“</th>
            <th class="col-schedule">å…¨æœŸé€²åº¦</th>
            <th class="col-status">ç‹€æ…‹</th>
            <th class="col-action">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </main>

  <div class="overlay" id="overlay" onclick="closeDrawer()"></div>
  <div class="drawer" id="drawer">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
      <h2 id="drawerTitle" style="margin:0">ç¶­è­·ç·¨è¼¯</h2>
      <button class="btn btn-outline" style="padding:5px; border-radius:50%" onclick="closeDrawer()"><span class="material-symbols-rounded">close</span></button>
    </div>
    <form id="formEdit">
      <div id="adminOnlyFields">
        <div style="margin-bottom:12px;"><label style="font-size:0.85rem; font-weight:600;">å®¢æˆ¶åç¨±</label><input type="text" id="customer" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:8px;" required></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:12px;">
          <div><label style="font-size:0.85rem;">ç”¢å“</label><select id="product" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border);"><option value="ee-class">ee-class</option><option value="Adobe Connect">Adobe Connect</option><option value="km+">km+</option><option value="tms+">tms+</option></select></div>
          <div><label style="font-size:0.85rem;">æ¥­å‹™</label><select id="salesName" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border);"><option value="Willa">Willa</option><option value="Melissa">Melissa</option><option value="Anita">Anita</option></select></div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:12px;">
          <div><label style="font-size:0.85rem;">ç¶­è­·èµ·æ—¥</label><input type="date" id="startDate" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border);" onchange="handleDateChange()"></div>
          <div><label style="font-size:0.85rem;">ç¶­è­·è¨–æ—¥</label><input type="date" id="endDate" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border);"></div>
        </div>
        <div class="ym-manager">
          <label style="font-size:0.85rem; font-weight:600;">ç¶­è­·æœˆä»½ç®¡ç† (èµ·æœˆ+3èµ·ç®—)</label>
          <div style="display:flex; gap:5px; margin-top:5px;">
            <input type="month" id="manualYM" class="btn btn-outline" style="flex:1">
            <button type="button" class="btn btn-outline" onclick="addYM()">æ‰‹å‹•æ–°å¢</button>
          </div>
          <div class="ym-list" id="ymList"></div>
        </div>
      </div>
      <div style="margin-top:20px; margin-bottom:12px;">
        <label style="font-size:0.85rem; font-weight:600;">ç¶­è­·å‚™è¨»</label>
        <div id="editor-wrapper"><div id="editor-container" style="height:180px;"></div></div>
        <div id="note-viewer" style="display:none; padding:15px; border:1px solid var(--border); border-radius:8px; background:#fff; min-height:80px;"></div>
      </div>
      <div id="adminAction" style="display:none;">
        <button type="submit" class="btn btn-primary" style="width:100%; padding:12px;">å„²å­˜ç¶­è­·è³‡æ–™</button>
        <button type="button" id="btnDelete" class="btn btn-outline" style="width:100%; margin-top:10px; color:var(--danger);">åˆªé™¤ç´€éŒ„</button>
      </div>
    </form>
  </div>

  <div class="modal" id="doneModal" style="z-index:1200;">
    <h3 style="margin-top:0;">å®Œå·¥ç”³å ±</h3>
    <div style="margin-bottom:10px;"><label>å¯¦éš›å®Œå·¥æ—¥</label><input type="date" id="mDoneDate" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:8px;"></div>
    <div style="margin-bottom:15px;"><label>ç¶­è­·å·¥ç¨‹å¸«</label><select id="mEngName" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:8px;"><option value="Willa">Willa</option><option value="Charlie">Charlie</option></select></div>
    <div style="display:flex; gap:10px;"><button id="mSave" class="btn btn-primary" style="flex:1;">æäº¤</button><button onclick="closeModal()" class="btn btn-outline" style="flex:1;">å–æ¶ˆ</button></div>
  </div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbznmfZ1quMslZxY6dftt_83uYqUGTh9THmoIO4LdFx7O9CPl0eKn2vvLP0YqM9nv2jf/exec?token=otsukakh5501398";
  let records = [], mode = "user", editingId = null, quill, modalTarget = null, editingYMList = [];

  async function load() {
    let pwd = sessionStorage.getItem('sys_pwd') || prompt("ğŸ”’ è«‹è¼¸å…¥ç³»çµ±å¯†ç¢¼ï¼š");
    if (!pwd) { location.reload(); return; }
    try {
      const resp = await fetch(`${API_URL}&pwd=${encodeURIComponent(pwd)}`);
      const data = await resp.json();
      if (data.status === "error") { sessionStorage.removeItem('sys_pwd'); location.reload(); return; }
      sessionStorage.setItem('sys_pwd', pwd);
      records = data; document.body.style.display = "block"; render();
    } catch (e) { alert("è®€å–å¤±æ•—"); }
  }

  function handleDateChange() {
    const startVal = document.getElementById('startDate').value;
    if(!startVal) return;
    const startDate = new Date(startVal);
    const endDate = new Date(startVal);
    endDate.setFullYear(startDate.getFullYear() + 1);
    endDate.setDate(endDate.getDate() - 1);
    document.getElementById('endDate').value = endDate.toISOString().slice(0, 10);
    editingYMList = [];
    const baseYear = startDate.getFullYear();
    const baseMonth = startDate.getMonth(); 
    [3, 6, 9, 12].forEach(offset => {
      const d = new Date(baseYear, baseMonth + offset, 1);
      editingYMList.push(d.toISOString().slice(0, 7));
    });
    renderYMList();
  }

  function addYM() {
    const val = document.getElementById('manualYM').value;
    if(val && !editingYMList.includes(val)) {
      editingYMList.push(val);
      editingYMList.sort();
      renderYMList();
    }
  }

  function removeYM(ym) {
    editingYMList = editingYMList.filter(x => x !== ym);
    renderYMList();
  }

  function renderYMList() {
    const container = document.getElementById('ymList');
    container.innerHTML = editingYMList.map(ym => `
      <div class="ym-tag">${ym} <span onclick="removeYM('${ym}')" style="cursor:pointer; color:var(--danger); font-weight:bold; margin-left:5px;">Ã—</span></div>
    `).join('');
  }

  function render() {
    const ym = document.getElementById('monthPick').value || new Date().toISOString().slice(0, 7);
    const q = document.getElementById('q').value.toLowerCase();
    const scope = document.getElementById('scope').value;
    const mInt = parseInt(ym.slice(5));

    document.getElementById('statDoneLabel').textContent = mInt + "æœˆå·²å®Œå·¥";
    document.getElementById('statTodoLabel').textContent = mInt + "æœˆå¾…è™•ç†";

    const filtered = records.filter(r => {
      const match = !q || r.customer.toLowerCase().includes(q) || (r.salesName||"").toLowerCase().includes(q) || r.product.toLowerCase().includes(q);
      const hasSch = (r.schedule || []).some(s => s.ym === ym);
      return (scope === 'need' ? hasSch : true) && match;
    }).sort((a,b) => a.customer.localeCompare(b.customer, 'zh-Hant'));

    document.getElementById('statTotal').textContent = records.length;
    document.getElementById('statDone').textContent = records.filter(r => r.schedule?.some(s => s.ym === ym && s.isDone)).length;
    document.getElementById('statTodo').textContent = records.filter(r => r.schedule?.some(s => s.ym === ym && !s.isDone)).length;

    const tbody = document.getElementById('rows');
    tbody.innerHTML = '';

    filtered.forEach(r => {
      const sch = (r.schedule || []).find(s => s.ym === ym);
      const hasNotes = r.notes && r.notes !== '<p><br></p>';
      
      tbody.insertAdjacentHTML('beforeend', `
        <tr>
          <td><span style="font-weight:700;">${r.customer}</span>${hasNotes ? `<span class="material-symbols-rounded note-indicator" onclick="openEdit('${r.id}', true)">description</span>` : ''}</td>
          <td><div style="font-size:0.8rem; color:var(--text-muted);">${r.product}</div><span class="sales-tag">${r.salesName}</span></td>
          <td style="font-size:0.85rem; color:var(--text-muted);">${r.startDate} ~ ${r.endDate}</td>
          <td><div class="month-group">${(r.schedule || []).map(s => `<span class="month-chip ${s.isDone?'is-done':''} ${s.ym===ym?'active':''}">${parseInt(s.ym.slice(5))}æœˆ</span>`).join('')}</div></td>
          <td>
            ${sch ? (sch.isDone ? `
              <div class="done-status-box">
                <div class="status-title">å®Œå·¥</div>
                <div class="status-meta">${sch.doneDate} / ${sch.engName}</div>
              </div>
            ` : `<span style="color:var(--warning); font-weight:700">â— å¾…ç¶­è­·</span>`) : '--'}
          </td>
          <td>
            <div style="display:flex; gap:6px;">
              ${sch ? `<button class="btn btn-outline" style="padding:6px" onclick="toggleDone('${r.id}','${ym}')" title="${sch.isDone?'é‚„åŸ':'å›å ±å®Œå·¥'}"><span class="material-symbols-rounded" style="font-size:20px;">${sch.isDone?'history':'done'}</span></button>` : ''}
              ${mode === 'admin' ? `<button class="btn btn-outline" style="padding:6px" onclick="openEdit('${r.id}')" title="ç·¨è¼¯"><span class="material-symbols-rounded" style="font-size:20px;">edit</span></button>` : ''}
            </div>
          </td>
        </tr>
      `);
    });
  }

  function openEdit(id = null, forceReadOnly = false) {
    editingId = id;
    const r = records.find(x => x.id === id) || { customer:"", product:"ee-class", salesName:"Willa", startDate:"", endDate:"", notes:"", schedule: [] };
    const isViewOnly = forceReadOnly || mode === 'user';
    document.getElementById('adminOnlyFields').style.display = isViewOnly ? 'none' : 'block';
    document.getElementById('adminAction').style.display = isViewOnly ? 'none' : 'block';
    document.getElementById('drawerTitle').textContent = isViewOnly ? "å‚™è¨»å…§å®¹" : (id ? "ç·¨è¼¯ç¶­è­·" : "æ–°å¢ç¶­è­·");
    if(isViewOnly) {
      document.getElementById('editor-wrapper').style.display = 'none';
      document.getElementById('note-viewer').style.display = 'block';
      document.getElementById('note-viewer').innerHTML = r.notes || 'å°šç„¡å‚™è¨»';
    } else {
      document.getElementById('editor-wrapper').style.display = 'block';
      document.getElementById('note-viewer').style.display = 'none';
      quill.root.innerHTML = r.notes || "";
    }
    document.getElementById('customer').value = r.customer;
    document.getElementById('product').value = r.product;
    document.getElementById('salesName').value = r.salesName;
    document.getElementById('startDate').value = r.startDate;
    document.getElementById('endDate').value = r.endDate;
    editingYMList = (r.schedule || []).map(s => s.ym);
    renderYMList();
    document.getElementById('drawer').classList.add('open');
    document.getElementById('overlay').style.display = 'block';
  }

  function toggleDone(id, ym) {
    const r = records.find(x => x.id === id);
    const sch = r.schedule.find(s => s.ym === ym);
    if(sch.isDone) { if(confirm("ç¢ºå®šé‚„åŸå®Œå·¥ç‹€æ…‹ï¼Ÿ")) { sch.isDone = false; save(); } }
    else {
      modalTarget = { id, ym };
      document.getElementById('mDoneDate').value = new Date().toISOString().slice(0,10);
      document.getElementById('doneModal').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }
  }

  async function save() {
    const pwd = sessionStorage.getItem('sys_pwd');
    await fetch(`${API_URL}&pwd=${encodeURIComponent(pwd)}`, { method: "POST", body: JSON.stringify(records) });
    render();
  }

  function closeDrawer() { document.getElementById('drawer').classList.remove('open'); document.getElementById('overlay').style.display = 'none'; closeModal(); }
  function closeModal() { document.getElementById('doneModal').style.display = 'none'; }

  document.getElementById('formEdit').onsubmit = async (e) => {
    e.preventDefault();
    const rData = {
      id: editingId || 'ID-' + Date.now(),
      customer: document.getElementById('customer').value,
      product: document.getElementById('product').value,
      salesName: document.getElementById('salesName').value,
      startDate: document.getElementById('startDate').value,
      endDate: document.getElementById('endDate').value,
      notes: quill.root.innerHTML === '<p><br></p>' ? '' : quill.root.innerHTML,
      schedule: editingYMList.map(ym => {
        const old = (records.find(x => x.id === editingId)?.schedule || []).find(s => s.ym === ym);
        return old || { ym, isDone: false, doneDate: "", engName: "" };
      })
    };
    if(!editingId) records.push(rData); else records[records.findIndex(x => x.id === editingId)] = rData;
    await save(); closeDrawer();
  };

  document.getElementById('btnDelete').onclick = async () => {
    if(confirm("ç¢ºå®šåˆªé™¤ç´€éŒ„ï¼Ÿ")) { records = records.filter(x => x.id !== editingId); await save(); closeDrawer(); }
  };

  document.getElementById('mSave').onclick = async () => {
    const r = records.find(x => x.id === modalTarget.id);
    const sch = r.schedule.find(s => s.ym === modalTarget.ym);
    sch.isDone = true; sch.engName = document.getElementById('mEngName').value; sch.doneDate = document.getElementById('mDoneDate').value;
    await save(); closeModal(); closeDrawer();
  };

// ä¿®æ”¹å¾Œçš„æ¨¡å¼åˆ‡æ›é‚è¼¯
document.getElementById('modeSeg').onclick = (e) => {
    const b = e.target.closest('button'); if(!b) return;
    mode = b.dataset.mode;
    document.querySelectorAll('.mode-btn').forEach(x => x.classList.toggle('active', x===b));
    
    // æ§åˆ¶æ–°å¢æŒ‰éˆ•é¡¯ç¤º
    document.getElementById('btnNew').style.display = mode === 'admin' ? 'inline-flex' : 'none';
    
    // --- æ–°å¢ï¼šæ§åˆ¶ç‰ˆæœ¬è™Ÿé¡¯ç¤º ---
    document.getElementById('versionTag').style.display = mode === 'admin' ? 'inline-block' : 'none';
    
    render();
};

  document.addEventListener('DOMContentLoaded', () => {
    quill = new Quill('#editor-container', { theme: 'snow', modules: { toolbar: [['bold', 'underline'], [{'color':[]}], ['clean']] } });
    document.getElementById('monthPick').value = new Date().toISOString().slice(0, 7);
    load();
  });
  document.getElementById('q').oninput = render;
  document.getElementById('monthPick').onchange = render;
  document.getElementById('scope').onchange = render;
  document.getElementById('btnNew').onclick = () => openEdit();
</script>
</body>
</html>
